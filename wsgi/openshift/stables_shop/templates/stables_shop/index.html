{% extends "base.html" %}
{% load i18n %}

{% block content %}
<h3>{% trans "Unfinished orders" %}</h3>
<table class="table">
    <thead>
        <tr>
            <th>{% trans "Id" %}</th>
            <th>{% trans "Status" %}</th>
            <th>{% trans "Target" %}</th>
            <th>{% trans "Product" %}</th>
            <th>{% trans "Total" %}</th>
            <th>{% trans "Is paid" %}</th>
            <th>{% trans "Is shipped" %}</th>
            <th>{% trans "Transaction" %}</th>
            <th>{% trans "Actions" %}</th>
        </tr>
    </thead>
    <tbody>
    {% for o in orders %}
      {% if not o.is_paid or not o.is_shipped %}
        <tr>
          <form method="POST"
                {% if not o.is_paid %}
                    action="{% url "order-paid" %}"
                {% elif not o.is_shipped %}
                    action="{% url "order-ship" %}" 
                {% endif %}
            >
                {% csrf_token %}
            <td>{{ o.id }}</td>
            <td>{{ o.get_status_display }}</td>
            {% if o.is_paid and not o.is_shipped %}
            <td>
                <input type="text" name="target_name" value="{{ o.shipping_address_text }}"/>
            </td>
            {% else %}
            <td>{{ o.shipping_address_text }}</td>
            {% endif %}
            <td>{{ o.items.all.0.product_name }}</td>
            <td>{{ o.order_total }}</td>
            <td>{{ o.is_paid }}</td>
            <td>{{ o.is_shipped }}</td>
            <td>{{ o.orderpayment_set.all.0.transaction_id }}</td>
            <td>
                {% if not o.is_paid %}
                    <input type="hidden" name="order" value="{{ o.id }}" />
                    <input type="hidden" name="amount" value="{{ o.order_total }}" />
                    <input type="hidden" name="transaction_id" value="{{ o.orderpayment_set.all.0.transaction_id }}"/>
                    <input type="hidden" name="payment_method" value="{{ o.orderpayment_set.all.0.payment_method }}"/>
                    <button>{% trans "Paid" %}</button>
                {% elif not o.is_shipped %}
                    <input type="hidden" name="order" value="{{ o.id }}" />
                    <button>{% trans "Ship" %}</button>
                {% endif %}
            </td>
           </form>
        </tr>
      {% endif %}
    {% endfor %}
    </tbody>
</table>

<h3>{% trans "Products" %}</h3>
<table class="table">
    <thead>
        <tr>
            <th>{% trans "Id" %}</th>
            <th>{% trans "Active" %}</th>
            <th>{% trans "Name" %}</th>
            <th>{% trans "Edit" %}</th>
        </tr>
    </thead>
    <tbody>
    {% for p in products %}
    <tr>
        <td>{{ p.id }}</td>
        <td>{{ p.active }}</td>
        <td>{{ p.name }}</td>
        <td><a href="{% url "product-edit" pk=p.id %}">{% trans "Edit" %}</a></td>
    </tr>
    {% endfor %}
    </tbody>
</table>

{% trans "Add new ..." %}
{% for p, ct in newproducts.items %}
<a href="{% url "product-add" ct.id %}">{{ ct.name|capfirst }}</a>
{% endfor %}
{% endblock %}
